 Plan to implement                                                                                                                                                                                         │
│                                                                                                                                                                                                           │
│ GTA-Link Integration Plan                                                                                                                                                                                 │
│                                                                                                                                                                                                           │
│ Overview                                                                                                                                                                                                  │
│                                                                                                                                                                                                           │
│ Integrate GTA-Link post-processing into colab_notebook.py to improve tracker ID consistency using ReID-based tracklet refinement.                                                                         │
│                                                                                                                                                                                                           │
│ GTA-Link Pipeline:                                                                                                                                                                                        │
│ 1. Phase 1: Extract OSNet ReID features from tracking results                                                                                                                                             │
│ 2. Phase 2: Split tracklets with multiple identities (DBSCAN), merge fragmented IDs (hierarchical clustering)                                                                                             │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Data Format Conversion                                                                                                                                                                                    │
│                                                                                                                                                                                                           │
│ Football Tracker -> MOT Format                                                                                                                                                                            │
│                                                                                                                                                                                                           │
│ # Football Tracker format (detections_per_frame)                                                                                                                                                          │
│ {                                                                                                                                                                                                         │
│   "Player": { track_id: {"bbox": [x1,y1,x2,y2], "confidence": float} },                                                                                                                                   │
│   "Goalkeeper": { ... }                                                                                                                                                                                   │
│ }                                                                                                                                                                                                         │
│                                                                                                                                                                                                           │
│ # MOT format (.txt) - 1-indexed frames, xywh bbox                                                                                                                                                         │
│ <frame>, <id>, <bb_left>, <bb_top>, <bb_width>, <bb_height>, <conf>, -1, -1, -1                                                                                                                           │
│                                                                                                                                                                                                           │
│ Conversion: frame_idx+1, x=x1, y=y1, w=x2-x1, h=y2-y1                                                                                                                                                     │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Implementation Plan                                                                                                                                                                                       │
│                                                                                                                                                                                                           │
│ 1. Add GTA-Link Installation Cell (after Cell 1)                                                                                                                                                          │
│                                                                                                                                                                                                           │
│ # Cell 1a: GTA-Link Installation (Optional)                                                                                                                                                               │
│ USE_GTA_LINK = True  # Toggle                                                                                                                                                                             │
│                                                                                                                                                                                                           │
│ if USE_GTA_LINK:                                                                                                                                                                                          │
│     !git clone https://github.com/sjc042/gta-link.git                                                                                                                                                     │
│     !pip install -q scikit-learn loguru seaborn Cython                                                                                                                                                    │
│     %cd gta-link/reid && python setup.py develop --quiet && %cd ../..                                                                                                                                     │
│     # Model checkpoint included in repo: gta-link/reid_checkpoints/sports_model.pth.tar-60 (~30MB)                                                                                                        │
│                                                                                                                                                                                                           │
│ 2. Add GTA-Link Configuration Cell                                                                                                                                                                        │
│                                                                                                                                                                                                           │
│ # Cell 1b: GTA-Link Configuration                                                                                                                                                                         │
│ @dataclass                                                                                                                                                                                                │
│ class GTALinkConfig:                                                                                                                                                                                      │
│     model_path: str = "gta-link/reid_checkpoints/sports_model.pth.tar-60"                                                                                                                                 │
│     # Split params                                                                                                                                                                                        │
│     eps: float = 0.6                                                                                                                                                                                      │
│     min_samples: int = 10                                                                                                                                                                                 │
│     max_k: int = 3                                                                                                                                                                                        │
│     min_len: int = 100                                                                                                                                                                                    │
│     # Merge params                                                                                                                                                                                        │
│     merge_dist_thres: float = 0.4                                                                                                                                                                         │
│     spatial_factor: float = 1.0                                                                                                                                                                           │
│                                                                                                                                                                                                           │
│ 3. Create gta_link_processor.py Module                                                                                                                                                                    │
│                                                                                                                                                                                                           │
│ Contains all the core functions (imported by notebook):                                                                                                                                                   │
│                                                                                                                                                                                                           │
│ Function: convert_to_mot_format(detections_per_frame, output_path)                                                                                                                                        │
│ - Convert xyxy->xywh bbox format                                                                                                                                                                          │
│ - Convert 0-indexed to 1-indexed frames                                                                                                                                                                   │
│ - Combine Player + Goalkeeper classes                                                                                                                                                                     │
│ - Save as MOT .txt file                                                                                                                                                                                   │
│                                                                                                                                                                                                           │
│ Function: convert_from_mot_format(mot_path, original_detections, team_mapping)                                                                                                                            │
│ - Match refined IDs to original by IoU                                                                                                                                                                    │
│ - Propagate team assignments to new/merged IDs                                                                                                                                                            │
│ - Preserve Ball detections unchanged                                                                                                                                                                      │
│                                                                                                                                                                                                           │
│ Function: save_frames_for_gta_link(frames, output_dir)                                                                                                                                                    │
│ - Save as {output_dir}/video/img1/000001.jpg, 000002.jpg, ...                                                                                                                                             │
│                                                                                                                                                                                                           │
│ 4. Add GTA-Link Phase 1 Function                                                                                                                                                                          │
│                                                                                                                                                                                                           │
│ Function: run_gta_link_phase1(model_path, data_path, mot_path)                                                                                                                                            │
│ - Load OSNet FeatureExtractor                                                                                                                                                                             │
│ - For each frame: extract crops, extract 512-dim features                                                                                                                                                 │
│ - Build Tracklet objects with features                                                                                                                                                                    │
│ - Return {track_id: Tracklet} dict                                                                                                                                                                        │
│                                                                                                                                                                                                           │
│ 5. Add GTA-Link Phase 2 Function                                                                                                                                                                          │
│                                                                                                                                                                                                           │
│ Function: run_gta_link_phase2(tracklets, config)                                                                                                                                                          │
│ - Import from gta-link: split_tracklets, merge functions                                                                                                                                                  │
│ - Run splitting (DBSCAN clustering)                                                                                                                                                                       │
│ - Run merging (hierarchical + spatial validation)                                                                                                                                                         │
│ - Return refined tracklets                                                                                                                                                                                │
│                                                                                                                                                                                                           │
│ 6. Add Main Integration Function                                                                                                                                                                          │
│                                                                                                                                                                                                           │
│ Function: run_gta_link_refinement(detections_per_frame, frames, team_mapping, config)                                                                                                                     │
│ 1. Save frames to temp dir                                                                                                                                                                                │
│ 2. Convert detections to MOT format                                                                                                                                                                       │
│ 3. Run Phase 1 (feature extraction)                                                                                                                                                                       │
│ 4. Run Phase 2 (refinement)                                                                                                                                                                               │
│ 5. Convert back to Football Tracker format                                                                                                                                                                │
│ 6. Return (refined_detections, updated_team_mapping)                                                                                                                                                      │
│                                                                                                                                                                                                           │
│ 7. Modify Cell 5 (Run Tracking)                                                                                                                                                                           │
│                                                                                                                                                                                                           │
│ After tracking, before team assignment:                                                                                                                                                                   │
│ if USE_GTA_LINK:                                                                                                                                                                                          │
│     detections_per_frame, team_mapping = run_gta_link_refinement(                                                                                                                                         │
│         detections_per_frame, frames, {}, gta_config                                                                                                                                                      │
│     )                                                                                                                                                                                                     │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Files to Create/Modify                                                                                                                                                                                    │
│ ┌───────────────────────┬────────────────────────────────────────────────────────────────────────────────────────┐                                                                                        │
│ │         File          │                                        Changes                                         │                                                                                        │
│ ├───────────────────────┼────────────────────────────────────────────────────────────────────────────────────────┤                                                                                        │
│ │ gta_link_processor.py │ NEW - Contains all GTA-Link functions (conversion, phase 1, phase 2, main integration) │                                                                                        │
│ ├───────────────────────┼────────────────────────────────────────────────────────────────────────────────────────┤                                                                                        │
│ │ colab_notebook.py     │ Add Cells 1a (installation), 1b (config), import gta_link_processor, modify Cell 5     │                                                                                        │
│ └───────────────────────┴────────────────────────────────────────────────────────────────────────────────────────┘                                                                                        │
│ ---                                                                                                                                                                                                       │
│ Pipeline Flow (After Integration)                                                                                                                                                                         │
│                                                                                                                                                                                                           │
│ Video -> Detection (YOLO) -> Tracking (BoTSORT)                                                                                                                                                           │
│   -> [GTA-Link Refinement] <-- NEW (optional)                                                                                                                                                             │
│   -> Team Assignment -> Processing -> Visualization                                                                                                                                                       │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Key Dependencies (GTA-Link)                                                                                                                                                                               │
│                                                                                                                                                                                                           │
│ - torchreid (installed from local reid/ folder)                                                                                                                                                           │
│ - scikit-learn (DBSCAN clustering)                                                                                                                                                                        │
│ - scipy (distance calculations)                                                                                                                                                                           │
│ - loguru (logging)                                                                                                                                                                                        │
│ - OSNet model: sports_model.pth.tar-60 (~30MB)                                                                                                                                                            │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Error Handling                                                                                                                                                                                            │
│                                                                                                                                                                                                           │
│ 1. Skip GTA-Link if USE_GTA_LINK = False                                                                                                                                                                  │
│ 2. Handle missing model checkpoint gracefully                                                                                                                                                             │
│ 3. Process features in batches if GPU OOM                                                                                                                                                                 │
│ 4. Clean up temp files after processing                                                                                                                                                                   │
│                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                       │
│ Testing                                                                                                                                                                                                   │
│                                                                                                                                                                                                           │
│ 1. Run on short clip (2-3 seconds)                                                                                                                                                                        │
│ 2. Verify ID count changes appropriately                                                                                                                                                                  │
│ 3. Check team assignments preserved after merge/split   